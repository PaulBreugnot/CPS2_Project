<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Pixled</title>

    <script src="keycloak.js"></script>
    <script type="text/javascript">
        var keycloak = Keycloak();

        keycloak.init({
            onLoad: 'login-required'
        });

        var loadData = function() {
            var url = 'http://localhost:8080/restful-service';

            var req = new XMLHttpRequest();
            req.open('GET', url, true);
            req.setRequestHeader('Accept', 'application/json');
            req.setRequestHeader('Authorization', 'Bearer ' + keycloak.token);

            req.onreadystatechange = function() {
                if (req.readyState == 4) {
                    if (req.status == 200) {
			    alert('Success');
                    } else if (req.status == 403) {
                        alert('Forbidden');
                    }
                }
            }

            req.send();
        };

        keycloak.updateToken(30).success(function() {
            loadData();
        }).error(function() {
            alert('Failed to refresh token');
        });

    </script>
</head>

<body>
    <noscript>
        <strong>We're sorry but demo doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>

    <script type="text/javascript"> window.open("http://localhost:8081","_self") </script>

</body>

</html>
